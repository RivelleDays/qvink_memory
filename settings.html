<div id="qvink_memory_settings">
    <div class="inline-drawer">

        <div class="inline-drawer-toggle inline-drawer-header">
            <div class="flex-container alignitemscenter margin0">
                <b>Qvink Memory</b>
                <i id="popout_button" class="fa-solid fa-window-restore menu_button margin0"></i>
            </div>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>

        <div class="inline-drawer-content">
            <div id="drawer_content">
                <h4 class="textAlignCenter">Current Memory State <i class="fa-solid fa-info-circle" title="The current state of memory for this chat. Updates automatically as additional memory is added."></i></h4>

                <textarea id="memory_display" class="text_pole textarea_compact" rows="6" placeholder="Current memory injection will display here" readonly></textarea>

                <div class="flex-container justifyspacebetween alignitemscenter">
                    <div id="refresh_memory" class="menu_button flex1 margin0" title="Reload memory from current chat state (does NOT re-summarize, just refreshes which messages are included based on current inclusion criteria)">
                        <span>Refresh</span>
                    </div>
                </div>

                <!-- Injection settings -->
                <h4 class="textAlignCenter">Injection Settings</h4>
                <label for="include_user_messages" title="Whether to include user messages." class="checkbox_label">
                    <input id="include_user_messages" type="checkbox" />
                    <span>Include User Messages</span>
                </label>

                <label for="message_length_threshold" title="The minimum token length a message has to be in order to get included.">
                    <input id="message_length_threshold" class="text_pole widthUnset" type="number" min="0" max="999" />
                    <span>Message Length Threshold</span>
                </label>


                <!-- Long-term memory -->
                <h4 class="textAlignCenter">Long-Term Memory Injection</h4>
                <div class="template">
                    <label for="long_template">Injection Template</label>
                    <textarea id="long_template" class="text_pole textarea_compact" rows="2"  placeholder="Use &lcub;&lcub;qvink_long_memory&rcub;&rcub;"></textarea>
                </div>
                <label for="long_term_context_limit" title="The max proportion of the context that long-term memory can take up.">
                    <input id="long_term_context_limit" class="text_pole widthUnset" type="number" min="0" max="999" />
                    <span>Long-Term Context Proportion (<span id="long_term_context_limit_display"></span>)</span>
                </label>
                <label class="checkbox_label" for="long_term_scan" title="Include long-term memory in the World Info Scan">
                    <input id="long_term_scan" type="checkbox" />
                    <span>Include in World Info Scanning</span>
                </label>
                <label>Long-Term Memory Injection Position</label>
                <div class="radio_group">
                    <label>
                        <input type="radio" name="long_term_position" value="-1" />
                        <span>None (not injected)</span>
                    </label>
                    <label>
                        <input type="radio" name="long_term_position" value="2" />
                        <span>Before Main Prompt / Story String</span>
                    </label>
                    <label>
                        <input type="radio" name="long_term_position" value="0" />
                        <span >After Main Prompt / Story String</span>
                    </label>
                    <label class="flex-container alignItemsCenter" title="How many messages before the current end of the chat.">
                        <input type="radio" name="long_term_position" value="1" />
                        <span>In-chat at depth</span>
                        <input id="long_term_depth" class="text_pole widthUnset" type="number" min="0" max="999" />
                        <span>as</span>
                        <select id="long_term_role" class="text_pole widthNatural">
                            <option value="0">System</option>
                            <option value="1">User</option>
                            <option value="2">Assistant</option>
                        </select>
                    </label>
                </div>

                <!-- Short-term memory -->
                <h4 class="textAlignCenter">Short-Term Memory Injection</h4>
                <div class="template">
                    <label for="short_template">Injection Template</label>
                    <textarea id="short_template" class="text_pole textarea_compact" rows="2"  placeholder="Use &lcub;&lcub;qvink_short_memory&rcub;&rcub;"></textarea>
                </div>
                <label for="short_term_context_limit" title="The max proportion of the context that short-term memory can take up.">
                    <input id="short_term_context_limit" class="text_pole widthUnset" type="number" min="0" max="999" />
                    <span>Short-Term Context Proportion (<span id="short_term_context_limit_display"></span>)</span>
                </label>
                <label class="checkbox_label" for="short_term_scan" title="Include short-term memory in the World Info Scan">
                    <input id="short_term_scan" type="checkbox" />
                    <span>Include in World Info Scanning</span>
                </label>
                <label>Short-Term Memory Injection Position</label>
                <div class="radio_group">
                    <label>
                        <input type="radio" name="short_term_position" value="-1" />
                        <span>None (not injected)</span>
                    </label>
                    <label>
                        <input type="radio" name="short_term_position" value="2" />
                        <span>Before Main Prompt / Story String</span>
                    </label>
                    <label>
                        <input type="radio" name="short_term_position" value="0" />
                        <span >After Main Prompt / Story String</span>
                    </label>
                    <label class="flex-container alignItemsCenter" title="How many messages before the current end of the chat.">
                        <input type="radio" name="short_term_position" value="1" />
                        <span>In-chat at depth</span>
                        <input id="short_term_depth" class="text_pole widthUnset" type="number" min="0" max="999" />
                        <span>as</span>
                        <select id="short_term_role" class="text_pole widthNatural">
                            <option value="0">System</option>
                            <option value="1">User</option>
                            <option value="2">Assistant</option>
                        </select>
                    </label>
                </div>



                <!-- Summarization -->
                <h4 class="textAlignCenter">Summarization</h4>
                <div class="flex-container justifyspacebetween alignitemscenter">
                    <div id="rerun_memory" class="menu_button flex1 margin0" title="Re-summarize all memories using current summarization settings.">
                        <span>Regenerate All Memories</span>
                    </div>
                </div>
                <label for="prompt" class="title_restorable">
                    <span>Summary Prompt</span>
                    <div id="prompt_restore" title="Restore default prompt" class="right_menu_button">
                        <div class="fa-solid fa-clock-rotate-left"></div>
                    </div>
                </label>
                <textarea id="prompt" class="text_pole textarea_compact" rows="6" placeholder="The prompt for generating summaries of individual messages. When this changes, only new summaries made will use it. To re-generate summaries, click 'Regenerate All Memories'"></textarea>

                <label for="auto_summarize" title="Enable automatic summarization (creates summarization for any new or edited message)" class="checkbox_label">
                    <input id="auto_summarize" type="checkbox" />
                    <span>Automatic Summarization</span>
                </label>


                <label for="include_world_info" title="Include World Info as context when summarizing?" class="checkbox_label">
                    <input id="include_world_info" type="checkbox" />
                    <span>Include World Info</span>
                </label>

                <label for="include_names" title="Include the name of the sender in the summary prompt?" class="checkbox_label">
                    <input id="include_names" type="checkbox" />
                    <span>Include Names</span>
                </label>

                <label for="block_chat" title="Block chat input while summarizing?" class="checkbox_label">
                    <input id="block_chat" type="checkbox" />
                    <span>Block Chat</span>
                </label>

                <label for="summary_maximum_length" title="The maximum token length a summary is allowed to be before cutting it off.">
                    <input id="summary_maximum_length" class="text_pole widthUnset" type="number" min="0" max="999" />
                    <span>Summary Max Length</span>
                </label>


                <h4 class="textAlignCenter">Misc.</h4>
                <label for="debug_mode" title="Fill your console with debug messages" class="checkbox_label">
                    <input id="debug_mode" type="checkbox" />
                    <span>Debug Mode</span>
                </label>
            </div>
        </div>
    </div>
</div>
