<div id="qvink_memory_settings">
    <div class="inline-drawer">

        <div class="inline-drawer-toggle inline-drawer-header">
            <div class="flex-container alignitemscenter margin0">
                <b>Qvink Memory</b>
                <i id="popout_button" class="fa-solid fa-window-restore menu_button margin0"></i>
            </div>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>

        <div class="inline-drawer-content">
            <div id="drawer_content">

                <h4 class="textAlignCenter">Default Profile for Current Character <i class="fa-solid fa-info-circle" title="Choose a profile to be selected automatically when you use the current character."></i></h4>
                <select id="character_profile" class="flex1 text_pole"></select>

                <hr>
                <h4 class="textAlignCenter">Active Profile <i class="fa-solid fa-info-circle" title="The configuration profile currently active."></i></h4>
                <div class="flex-container justifyspacebetween alignitemscenter">
                    <select id="profile" class="flex1 text_pole" title="The currently selected profile"></select>
                    <i id="save_profile" class="menu_button fa-solid fa-save interactable" title="Save current profile" tabindex="0"></i>
                    <i id="rename_profile" class="menu_button fa-solid fa-pencil interactable" title="Rename current profile" tabindex="0"></i>
                    <i id="new_profile" class="menu_button fa-solid fa-file-circle-plus interactable" title="Create new profile" tabindex="0"></i>
                    <i id="restore_profile" class="menu_button fa-solid fa-recycle interactable" title="Restore current profile" tabindex="0"></i>
                    <i id="delete_profile" class="menu_button fa-solid fa-trash-can interactable" title="Delete current profile" tabindex="0"></i>
                </div>

                <hr>
                <h4 class="textAlignCenter">Current Memory State <i class="fa-solid fa-info-circle" title="The current state of memory for this chat. Updates automatically as additional memory is added."></i></h4>

                <textarea id="memory_display" class="text_pole textarea_compact" rows="6" placeholder="Current memory injection will display here" readonly></textarea>

                <div class="flex-container justifyspacebetween alignitemscenter">
                    <div id="refresh_memory" class="menu_button flex1 margin0" title="Reload memory from current chat state (does NOT re-summarize, just refreshes which messages are included based on current inclusion criteria)">
                        <span>Refresh</span>
                    </div>
                </div>

                <!-- Injection settings -->
                <hr>
                <h4 class="textAlignCenter">Inclusion Criteria  <i class="fa-solid fa-info-circle" title="Determines which messages are included in the memory injection. Changing these may require re-summarization, since excluded messages aren't summarized automatically."></i></h4>
                <label for="include_user_messages" title="Include user message summaries in memory." class="checkbox_label">
                    <input id="include_user_messages" type="checkbox" />
                    <span>Include User Messages</span>
                </label>

                <label for="include_thought_messages" title="Include thought message summaries in memory (from the Stepped Thinking extension)." class="checkbox_label">
                    <input id="include_thought_messages" type="checkbox" />
                    <span>Include Thought Message</span>
                </label>

                <label for="message_length_threshold" title="The minimum token length a message has to be in order to get included.">
                    <input id="message_length_threshold" class="text_pole widthUnset" type="number" min="0" max="999" />
                    <span>Message Length Threshold</span>
                </label>

                <!-- Short-term memory -->
                <hr>
                <h4 class="textAlignCenter">Short-Term Memory Injection</h4>
                <div class="template">
                    <textarea id="short_template" class="text_pole textarea_compact" rows="2"  placeholder="Use &lcub;&lcub;qvink_short_memory&rcub;&rcub;"></textarea>
                </div>
                <label for="short_term_context_limit" title="The max percent of the context that short-term memory can take up.">
                    <input id="short_term_context_limit" class="text_pole widthUnset" type="number" min="0" max="100" />
                    <span>Short-Term Context % (<span id="short_term_context_limit_display"></span> tk)</span>
                </label>
                <label class="checkbox_label" for="short_term_scan" title="Include short-term memory in the World Info Scan">
                    <input id="short_term_scan" type="checkbox" />
                    <span>Include in World Info Scanning</span>
                </label>
                <div class="radio_group">
                    <label>
                        <input type="radio" name="short_term_position" value="-1" />
                        <span>Do not inject</span>
                    </label>
                    <label>
                        <input type="radio" name="short_term_position" value="2" />
                        <span>Inject before main prompt / story string</span>
                    </label>
                    <label>
                        <input type="radio" name="short_term_position" value="0" />
                        <span >Inject after main prompt / story string</span>
                    </label>
                    <label class="flex-container alignItemsCenter" title="How many messages before the current end of the chat.">
                        <input type="radio" name="short_term_position" value="1" />
                        <span>Inject in chat at depth</span>
                        <input id="short_term_depth" class="text_pole inline_setting" type="number" min="0" max="99" />
                        <span>as</span>
                        <select id="short_term_role" class="text_pole inline_setting">
                            <option value="0">System</option>
                            <option value="1">User</option>
                            <option value="2">Assistant</option>
                        </select>
                    </label>
                </div>

                <!-- Long-term memory -->
                <hr>
                <h4 class="textAlignCenter">Long-Term Memory Injection</h4>
                <div class="template">
                    <textarea id="long_template" class="text_pole textarea_compact" rows="2"  placeholder="Use &lcub;&lcub;qvink_long_memory&rcub;&rcub;"></textarea>
                </div>
                <label for="long_term_context_limit" title="The max percent of the context that long-term memory can take up.">
                    <input id="long_term_context_limit" class="text_pole widthUnset" type="number" min="0" max="100" />
                    <span>Long-Term Context % (<span id="long_term_context_limit_display"></span> tk)</span>
                </label>
                <label class="checkbox_label" for="long_term_scan" title="Include long-term memory in the World Info Scan">
                    <input id="long_term_scan" type="checkbox" />
                    <span>Include in World Info Scanning</span>
                </label>
                <div class="radio_group">
                    <label>
                        <input type="radio" name="long_term_position" value="-1" />
                        <span>Do not inject</span>
                    </label>
                    <label>
                        <input type="radio" name="long_term_position" value="2" />
                        <span>Inject before main prompt / story string</span>
                    </label>
                    <label>
                        <input type="radio" name="long_term_position" value="0" />
                        <span>Inject after main prompt / story string</span>
                    </label>
                    <label class="flex-container alignItemsCenter" title="How many messages before the current end of the chat.">
                        <input type="radio" name="long_term_position" value="1" />
                        <span>Inject in chat at depth</span>
                        <input id="long_term_depth" class="text_pole inline_setting" type="number" min="0" max="99" />
                        <span>as</span>
                        <select id="long_term_role" class="text_pole inline_setting">
                            <option value="0">System</option>
                            <option value="1">User</option>
                            <option value="2">Assistant</option>
                        </select>
                    </label>
                </div>


                <!-- Summarization -->
                <hr>
                <h4 class="textAlignCenter">Summarization</h4>
                <div class="flex-container justifyspacebetween alignitemscenter">
                    <div id="rerun_memory" class="menu_button flex2" title="Re-summarize all memories using current summarization settings.">
                        <span>Regenerate All Memories</span>
                    </div>
                    <div id="stop_summarization" class="menu_button flex1" title="Stop summarizing the chat.">
                        <span>Stop</span>
                    </div>
                </div>
                <label for="prompt" class="title_restorable">
                    <span>Summary Prompt</span>
                    <div id="prompt_restore" title="Restore default prompt" class="right_menu_button">
                        <div class="fa-solid fa-clock-rotate-left"></div>
                    </div>
                </label>
                <textarea id="prompt" class="text_pole textarea_compact" rows="6" placeholder="The prompt for generating summaries of individual messages. When this changes, only new summaries made will use it. To re-generate summaries, click 'Regenerate All Memories'"></textarea>

                <label for="auto_summarize" title="Enable automatic summarization. New assistant messages will be summarized after being sent, edited, or swiped." class="checkbox_label">
                    <input id="auto_summarize" type="checkbox" />
                    <span>Automatic Summarization</span>
                </label>


                <label for="include_world_info" title="Include World Info as context when summarizing. If your world info is static, this can allow Context Shifting to work between summarizations." class="checkbox_label">
                    <input id="include_world_info" type="checkbox" />
                    <span>Include World Info</span>
                </label>

                <label for="include_names" title="Include the name of the sender in the summary prompt." class="checkbox_label">
                    <input id="include_names" type="checkbox" />
                    <span>Include Names</span>
                </label>

                <label for="include_last_user_message" title="Include the previous user message when summarizing assistant messages." class="checkbox_label">
                    <input id="include_last_user_message" type="checkbox" />
                    <span>Include Last User Message</span>
                </label>

                <label for="block_chat" title="Block chat input while summarizing." class="checkbox_label">
                    <input id="block_chat" type="checkbox" />
                    <span>Block Chat</span>
                </label>

                <label for="summary_maximum_length" title="The maximum token length a summary is allowed to be before cutting it off.">
                    <input id="summary_maximum_length" class="text_pole widthUnset" type="number" min="0" max="999" />
                    <span>Summary Max Length</span>
                </label>

                <!-- Misc. -->
                <hr>
                <h4 class="textAlignCenter">Misc.</h4>
                <label for="debug_mode" title="Fill your console with debug messages" class="checkbox_label">
                    <input id="debug_mode" type="checkbox" />
                    <span>Debug Mode</span>
                </label>

                <label for="display_memories" title="Display summarizations below each message" class="checkbox_label">
                    <input id="display_memories" type="checkbox" />
                    <span>Display Memories</span>
                </label>

                <div class="flex-container justifyspacebetween alignitemscenter">
                    <div id="revert_settings" class="menu_button flex1 margin0" title="Revert all settings to default (not the default profile, just the default that comes with the extension).">
                        <span>Revert Settings</span>
                    </div>
                </div>

                <!--
                <div class="flex-container justifyspacebetween alignitemscenter">
                    <div id="dump_to_lorebook" class="menu_button flex1" title="Dump all memories marked for long-term memory to a lorebook entry">
                        <span>Dump to Lorebook</span>
                    </div>
                </div>
                <textarea id="lorebook_entry" class="text_pole textarea_compact" rows="1" placeholder="Lorebook entry to dump to"></textarea>
                -->

            </div>
        </div>
    </div>
</div>
